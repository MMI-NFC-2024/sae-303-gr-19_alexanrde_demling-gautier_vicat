---
import "../styles/global.css";

const { title } = Astro.props;
---

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{title}</title>

    <!-- ✅ Librairies globales et fiables -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6.14/dist/plot.umd.min.js"></script>

    <!-- ✅ CSS Leaflet (sans integrity pour éviter le blocage) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  </head>

  <body class="font-sans bg-gray-50 text-gray-800">
    <!-- HEADER -->
    <header class="bg-white shadow-sm sticky top-0 z-[9999]">
      <nav class="max-w-7xl mx-auto flex justify-between items-center px-8 py-4">
        <a href="/" class="text-2xl font-bold text-blue-700 hover:text-blue-600 transition">
          Santé & Territoires
        </a>

        <ul class="flex space-x-8 text-gray-700 font-medium">
          <li><a href="/" class="hover:text-blue-600 transition">Accueil</a></li>
          <li><a href="/cartes" class="hover:text-blue-600 transition">Dataviz</a></li>
          <li><a href="/analyses" class="hover:text-blue-600 transition">Analyse</a></li>
        </ul>
      </nav>
    </header>

    <!-- CONTENU -->
    <main class="min-h-screen">
      <slot />
    </main>

    <!-- FOOTER -->
    <footer class="bg-gray-100 mt-16 py-6 text-center text-gray-700 text-sm border-t border-gray-300">
      <p class="mb-1 font-medium">
        © 2025 — <strong>Alexandre Demling & Gautier Vicat</strong>. Tous droits réservés.
      </p>
      <p class="max-w-2xl mx-auto text-gray-600 italic">
        <span class="block sm:inline">
          Comment aider les acteurs locaux à réaliser un diagnostic de santé publique sur leur territoire ?
        </span>
      </p>
    </footer>

    <!-- ✅ Sécurité : si Plot ou D3 n’est pas chargé, on recharge -->
    <script>
      window.addEventListener("load", () => {
        function ensureLibs() {
          if (!window.Plot || !window.d3) {
            console.warn("Rechargement des libs D3/Plot…");
            const d3Script = document.createElement("script");
            d3Script.src = "https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js";
            document.head.appendChild(d3Script);

            const plotScript = document.createElement("script");
            plotScript.src = "https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6.14/dist/plot.umd.min.js";
            document.head.appendChild(plotScript);
          }
        }

        ensureLibs();
        document.addEventListener("astro:page-load", ensureLibs);
      });
    </script>
  </body>
</html>
